pipeline {
    agent any
    tools {
        maven 'M2_HOME'
        jdk 'JAVA_HOME'
    }
 
     
    stages {
       stage ('SCM CHECKOUT') {
    steps {
      git branch: 'Yahia_ModuleFornisseur', url: 'https://github.com/yassinedarwezi/DevOps.git' }}
      stage('Maven Version'){
            steps {
                sh 'mvn -version'
            }
        }
	 stage('compile'){
            steps {
                sh 'mvn compile -e'
            }
        }
	
	
        
        stage('Maven Package') {
             steps {
                sh 'mvn clean package -DskipTests'
            
            }
        }
	
	
	 stage('Clean') {
            steps {
                sh 'mvn clean'
            }
        }
      
	stage('test'){
            steps {
                sh 'mvn test'
            }
	    }
	    
	    
          stage("sonar"){
        steps {
                withSonarQubeEnv ( installationName: 'SonarQube-8.9.7'){
                sh """./mvnw sonar:sonar -Dsonar.login=admin -Dsonar.password=yahia \
                -Dsonar.projectKey=tpAchatProject \
                -Dsonar.host.url=http://192.168.122.1:9000 \
                -Dsonar.coverage.jacoco.xmlReportPaths=../target/site/jacoco-aggregate/jacoco.xml """ 
                }
        }
        }  
         
	  stage("Publish to Nexus Repository Manager") {
            steps {
                 nexusArtifactUploader artifacts: [
                     [
                         artifactId: 'tpAchatProject',
                         classifier: '',
                         file: 'target/tpAchatProject-1.0.jar',
                         type: 'jar']], 
                     credentialsId: 'Devops',
                     groupId: 'com.esprit.examen', 
                     nexusUrl: '192.168.122.1:8081', 
                     nexusVersion: 'nexus3', 
                     protocol: 'http',
                     repository: 'achat-realeases',
                     version: '1.0'
            }
              }
	 

        
	

    }
}
